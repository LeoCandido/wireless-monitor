define(["jquery","moment","Chart","monitors/timeout","monitors/monitor"],function(t,o,n,e,r){function i(t,o,n){return t<o?o:t>n?n:t}function a(t){return t=Number(t),t<0?Math.ceil(t):Math.floor(t)}function s(){console.info("Promise loaded.")}function m(t){setTimeout(function(){r.measures(u,d,c).done(function(o){var n=o.items;t.render(n),t.plot(n),m(t)})},e)}var u=t("input#id").val(),h=t("div#monitor-view"),d=30,c="desc";n.defaults.global.animation=0;var l={moment:function(){return function(t,n){return o(n(t)).fromNow()}},getFgColor:function(){var t=a(this.data.min),o=a(this.data.max),n=o-t,e=n/3,r=a(this.item.data.value),i="#3498db";return r>=t&&r<t+e?i="#2c3e50":r>o-e&&r<=o&&(i="#18bc9c"),function(t,o){return i}},getValue:function(){var t=i(this.item.data.value,this.data.min,this.data.max);return function(o,n){return t}}},f=function(o,n){this.template=o,this.monitor=t.extend(n,l),this.chartOptions={scales:{yAxes:[{ticks:{min:1*this.monitor.data.min,max:1*this.monitor.data.max}}]}}};f.prototype.render=function(o){if(o=o||[],o.length>0){this.monitor.item=o[0];var n=r.render(this.template,this.monitor);h.html(n),t(".input-knob").knob({readOnly:!0,width:250,fontWeight:"hack"})}},f.prototype.plot=function(o){o=o||[];var e=[],r=[],a=o.length;if(a>0){for(var s=a-1;s>=0;s--){var m=o[s];e.push(m.created_at);var u=i(m.data.value,this.monitor.data.min,this.monitor.data.max);r.push(u)}var h=t("#photoresistor-chart"),d=h.get(0).getContext("2d");this.chart=new n(d,{type:"line",data:{labels:e,datasets:[{label:this.monitor.data.description,data:r,borderColor:"rgba(24,188,156,1)",pointBackgroundColor:"rgba(24,188,156,1)",pointBorderColor:"rgba(24,188,156,1)",pointHoverBackgroundColor:"#fff",pointBorderWidth:4,backgroundColor:"rgba(151,187,205,0.2)"}]},options:this.chartOptions})}},t.when(t.get("/templates/photoresistor/show.mustache"),r.fetch(u,s),r.measures(u,d,c,s)).done(function(o,n,e){var r=o[0],i=n[0].monitor,a=e[0].items,s=new f(r,i);s.render(a),s.plot(a),a.length||(h.html(""),t(".nav-tabs a#tab-setup").tab("show")),m(s)})});