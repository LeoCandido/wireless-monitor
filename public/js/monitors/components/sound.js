define(["jquery","moment","Chart","monitors/timeout","monitors/monitor"],function(t,o,n,a,e){function i(t,o,n){return t<o?o:t>n?n:t}function r(t){return t=Number(t),t<0?Math.ceil(t):Math.floor(t)}function s(){console.info("Promise loaded.")}function u(t){setTimeout(function(){e.measures(m,h,c).done(function(o){var n=o.items;t.render(n),t.plot(n),u(t)})},a)}var m=t("input#id").val(),d=t("div#monitor-view"),h=30,c="desc";n.defaults.global.animation=0;var l={moment:function(){return function(t,n){return o(n(t)).fromNow()}},getFgColor:function(){var t=r(this.data.min),o=r(this.data.max),n=o-t,a=n/3,e=r(this.item.data.value),i="#3498db";return e>=t&&e<t+a?i="#2c3e50":e>o-a&&e<=o&&(i="#18bc9c"),function(t,o){return i}},getValue:function(){var t=i(this.item.data.value,this.data.min,this.data.max);return function(o,n){return t}}},f=function(o,n){this.template=o,this.monitor=t.extend(n,l),this.chartOptions={scales:{yAxes:[{ticks:{min:1*this.monitor.data.min,max:1*this.monitor.data.max}}]}}};f.prototype.render=function(o){if(o=o||[],o.length>0){this.monitor.item=o[0];var n=e.render(this.template,this.monitor);d.html(n),t(".input-knob").knob({readOnly:!0,width:250,fontWeight:"hack"})}},f.prototype.plot=function(o){o=o||[];var a=[],e=[],r=o.length;if(r>0){for(var s=r-1;s>=0;s--){var u=o[s];a.push(u.created_at);var m=i(u.data.value,this.monitor.data.min,this.monitor.data.max);e.push(m)}var d=t("#sound-chart"),h=d.get(0).getContext("2d");this.chart=new n(h,{type:"line",data:{labels:a,datasets:[{label:this.monitor.data.description,data:e,borderColor:"rgba(24,188,156,1)",pointBackgroundColor:"rgba(24,188,156,1)",pointBorderColor:"rgba(24,188,156,1)",pointHoverBackgroundColor:"#fff",pointBorderWidth:4,backgroundColor:"rgba(151,187,205,0.2)"}]},options:this.chartOptions})}},t.when(t.get("/templates/sound/show.mustache"),e.fetch(m,s),e.measures(m,h,c,s)).done(function(o,n,a){var e=o[0],i=n[0].monitor,r=a[0].items,s=new f(e,i);s.render(r),s.plot(r),r.length||(d.html(""),t(".nav-tabs a#tab-setup").tab("show")),u(s)})});